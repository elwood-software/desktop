name: Publish

on:
  workflow_dispatch:
    inputs:
      releaseType:
        description: stable or canary?
        required: true
        type: choice
        options:
          - canary
          - stable

      semverType:
        description: semver type?
        type: choice
        options:
          - patch
          - minor
          - major
jobs:
  publish:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [macos-latest]

    steps:
      - name: Checkout git repo
        uses: actions/checkout@v3
        with:
          submodules: "true"

      - name: Git Submodule Update
        run: |
          git submodule update --remote

      - name: Install
        uses: ./elwood/.github/composite-actions/install
        with:
          working-directory: ./elwood

      - name: Build Packages
        working-directory: ./elwood
        run: pnpm build

      - name: Build Desktop App
        working-directory: ./elwood/apps/desktop
        run: pnpm build

      - name: Publish releases
        working-directory: ./elwood/apps/desktop
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          pnpm electron-builder -- --publish always --win
